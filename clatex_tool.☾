â®Œ PEGGLE2_BOOTSTRAP_AAUGH â¨¡ Peggle1Bootstrap
Parser = Peggle1Bootstrapî®¦â‚‚
â®Œ util â¨¡ SCRIPT
import sys
ó°‹º(â›ğ, â›ğ)
ó°‹º(â€¹functionsâ€º,*)

GRAM = â›
ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥
main = ws* preset? heading com_sequence

moon = ~â€¹â˜½[^â˜½]*â˜½â€º
texmoon = ~â€¹â¯[^â¯]*â¯â€º
fmoon = ~â€¹âš¸[^âš¸]*âš¸â€º
moons = moon âˆ¨ texmoon âˆ¨ fmoon

simple = word_seq âˆ¨ dollar_math âˆ¨ c_math âˆ¨ det_math_seq
component = comment âˆ¨ word_seq âˆ¨ list âˆ¨ dollar_math âˆ¨ c_math âˆ¨ env_math âˆ¨ det_math_seq âˆ¨ other_env
sequence = ws* (simple ws*)+
com_sequence = ws* (component ws*)+

other_env = ~â€¹[â“-â“©â’¶-â“ğŸ…-ğŸ…©â]â€º com_sequence â€¹â˜ â€º

preset = ~â€¹fun-math|complex-analysis-uarkâ€º
heading = ~â€¹(.|\n)*\\begin\{document\}â€º ws* (â€¹\maketitleâ€º)?

nondetect = ~â€¹[$â˜ â“-â“©â’¶-â“ğŸ…-ğŸ…©Â¢â]â€º âˆ¨ reserved
reserved = ~â€¹[ã€”ã€•âˆšâˆ›âˆœâŒâ«šâœ¿â•±âŠ¢âŒœâŒŸâ˜½â¯âš¸]â€º

com_math = (Â¬(open âˆ¨ close âˆ¨ nondetect) (en_section âˆ¨ subsupyee))+
p_com_math = open com_math_seq? close
com_math_seq = (â ¶moons âˆ¨ en_section âˆ¨ com_word âˆ¨ com_rad âˆ¨ com_frac âˆ¨ com_legendre âˆ¨ com_nCr âˆ¨ com_math âˆ¨ p_com_math âˆ¨ ws)+

block_math = (Â¬(open âˆ¨ close âˆ¨ nondetect) (block_en_section âˆ¨ subsupyee))+
p_block_math = open block_math_seq? close
block_math_seq = (â ¶moons âˆ¨ block_en_section âˆ¨ block_word âˆ¨ block_rad âˆ¨ block_frac âˆ¨ block_legendre âˆ¨ block_nCr âˆ¨ block_math âˆ¨ p_block_math âˆ¨ ws)+

punct = ~â€¹[.,?:;]â€º

line_math = (Â¬(open âˆ¨ close âˆ¨ nondetect âˆ¨ (punct? ws)) (break_en_section âˆ¨ subsupyee))+
p_line_math = open com_math_seq? close
line_math_seq = (â ¶moons âˆ¨ en_section âˆ¨ com_word âˆ¨ com_rad âˆ¨ com_frac âˆ¨ com_legendre âˆ¨ com_nCr âˆ¨ line_math âˆ¨ p_line_math)+

det_math = (Â¬(open âˆ¨ close âˆ¨ nondetect âˆ¨ (punct? ws)) (break_en_section âˆ¨ subsupyee))+
p_det_math = open com_math_seq? close
det_math_seq = (â ¶moons âˆ¨ en_section âˆ¨ com_word âˆ¨ com_rad âˆ¨ com_frac âˆ¨ com_legendre âˆ¨ com_nCr âˆ¨ det_math âˆ¨ p_det_math)+

dollar_math = (â€¹$â€º com_math_seq â€¹$â€º) âˆ¨ (â€¹$$â€º com_math_seq â€¹$$â€º) âˆ¨ (â€¹ó·¹¹â€º line_math_seq)
env_math = (~â€¹[â’¶â“]â€º âˆ¨ ~â€¹[â“‚â“œ]\{[0-9]+\}â€º) block_math_seq â€¹â˜ â€º
c_math = ~â€¹Â¢.[^ -~\n\t]*â€º

com_frac = â€¹(â€º com_math_seq â€¹â•±â€º com_math_seq â€¹)â€º
block_frac = â€¹(â€º block_math_seq â€¹â•±â€º block_math_seq â€¹)â€º
com_legendre = â€¹(â€º com_math_seq â€¹âœ¿â€º com_math_seq â€¹)â€º
block_legendre = â€¹(â€º block_math_seq â€¹âœ¿â€º block_math_seq â€¹)â€º
com_nCr = â€¹(â€º com_math_seq â€¹â«šâ€º com_math_seq â€¹)â€º
block_nCr = â€¹(â€º block_math_seq â€¹â«šâ€º block_math_seq â€¹)â€º
com_rad = (â€¹ã€”â€º com_math_seq â€¹ã€•â€º)? ~â€¹[âˆšâˆ›âˆœ]â€º com_math_seq â€¹âŒâ€º
block_rad = (â€¹ã€”â€º block_math_seq â€¹ã€•â€º)? ~â€¹[âˆšâˆ›âˆœ]â€º block_math_seq â€¹âŒâ€º
com_word = â€¹âŒœâ€º simple â€¹âŒŸâ€º
block_word = â€¹âŒœâ€º simple â€¹âŒŸâ€º

comment = ~â€¹[ó°¤±%].*\nâ€º
word = ~â€¹[!-#&-'\*-Z\\^-z\|~\[\({}\)\]]+â€º â®(~â€¹[ -~\n\tã€”ã€•âŒŸâ˜½âš¸]|$â€º)
p_word = wopen word_seq? wclose
word_seq = (â ¶moons âˆ¨ p_word âˆ¨ word)+

list = ~â€¹[â’¾â“”]â€º ws* (item com_sequence)* â€¹â˜ â€º
item = ~â€¹âŠ¢|\\item(!?[a-zA-Z])â€º ó°†´ws* (â€¹ã€”â€º sequence â€¹ã€•â€º)?

ws = ~â€¹[ \n\t]â€º

wopen = ~â€¹[\[\({]â€º
wclose = ~â€¹[}\)\]]â€º
open = ~â€¹[\[\({â¦‹â´âŒˆâŒŠâŸ¦â¦ƒâ¦…âŸ¬âŸ¨â¦‘â¥â¢¨ã€Šï½Ÿã€Â«ğŸ¢”]â€º
close = ~â€¹[ğŸ¢–Â»ã€‘ï½ ã€‹â¡…â¥‘â¦’âŸ©âŸ­â¦†â¦„âŸ§â‘âŒ‹âŒ‰âµâ¦Œ}\)\]]â€º

en_word = ~â€¹[ó°˜¨ó±•ó°¡·ó±˜ï´ó°¬€ó±‡™ó°‘‡ó°«°ó±¨¹ïƒï„¶â–¢ïˆ±ó°•ï”ó°Šó°¬ó°·”ó±î™³ó°¡±á¾‡ï‰½ó°«ºó°—´ó°¨¥ó°«´ó°«¿î˜¨ó°«³ó°¬ƒó±—¿ó°«±âŒó±§¡ó°«¶ó°¬‚ó°«½ó°«²î™‘ó°Š•â°ó°«®ó°Š°ó°’ó°š¥ó°‘ó°‰·ó° ©ó°‘­ó°‰½âœ“ó°Š„ï‰«ó°¿¨âš™ó°‰î‰¿ó°’ó°£°â‹â«¢â‰–âˆ€âˆƒâˆ§âˆ¨ğ…Ÿğ…¢âœ£â‰âŠá”²ğŸ¤â†˜Â¿Â¡âˆµâˆ´â†£âŸâš‡Ã†ó°˜¡ó°¡ó°˜£â‡â˜’ó°‡šó±‚°ó°®§ó±—ó±…™ó±–ó°¶€ó°¶ó°¶‚ó°¶ƒó°¶„â”âœ“âŠ¯â®â®ŒâªŸâª ó°¨ˆâ˜‘â˜’]|â….â€º subsup*
subsup = sub âˆ¨ sup
sup = ~â€¹[%topswag%]+â€º
sub = ~â€¹[%bottomswag%]+â€º
subsupyee = subsup âˆ¨ ~â€¹.â€º
en_section = en_word+
block_en_section = en_word+
break_en_section = en_word+

s = â€¹hiâ€º

ops0  = â€¹[Â¬âŸºâ‡’â‡]â€º
ops1  = â€¹[=â‰ â‰”â‰¡â‰¢â‰…â‰‡â‰¤â‰¥âˆˆâˆ‰âˆŒâˆ‹<>â‰®â‰¯â‰°â‰±â‰ºâ‰¼â‰¾âŠ€âª¯âª±â‰»â‰½â‰¿âŠâª°âª²âŠ‚âŠ„âŠŠâŠ†âŠˆâŠƒâŠ…âŠ‹âŠ‡âŠ‰|]â€º
ops2  = â€¹[â«šâœ¿]â€º
ops3  = â€¹[ï¹ªâ†‘â†“â¤‰â¤ˆ]â€º
ops4  = â€¹[+-Â±âˆ“]â€º
ops5  = â€¹[âˆªâˆ–âŠ•âŠ—â¨¸âŠ–]â€º
ops6  = â€¹[âˆ©]â€º
ops7  = â€¹[â¨¯â¨‰]â€º
ops8  = â€¹[â‹…âˆ—*/â•±Ã·â¹]â€º
ops9  = â€¹[ğŸƒŒâŒ—]â€º
ops10 = â€¹[âˆ˜ïâ‹„â™¢]â€º

ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥

GRAM=GRAM.replace(â€¹%topswag%â€º,SCRIPT.CHAR_SUPâ¨)
GRAM=GRAM.replace(â€¹%bottomswag%â€º,SCRIPT.CHAR_SUBâ¨)

dat = ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥\begin{document}

Look at my table: âš¸f=ó°²¡xâŒƒ2âš¸ â¯{â€¹ó·¹¹x â€º:[â€¹ó·¹¹f(x) â€º,â€¹ó·¹¹f(x)Â² â€º]}|{x:[f(x),f(x)Â²]âˆ€xâˆˆ10â­¥}â¯ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥
file_fail=âœ—
try:
    f = open(sys.argv[1]+".ctex","r",encoding="utf8")
    dat = f.read()
except:
    file_fail=âœ“

âŠ¢moo(c,m):
    Â¿mâ‰¡â›âš¸:
        ó± ¨(â›î®+c,ns=globals())
        â†ª
    s=ó± ¨(c,ns=globals())
    Â¿mâ‰¡â›â¯:
        â†ªîš›(s)
    â†ªá”(s)

GRAM = Parser(GRAM)

âŠ¢do_thing(dat,rule="main"):
    root = GRAM(dat, rule, DEBUG=âœ—)
    root = root.find_replace(ó°²¡âœ“, ó°²¡(xáµ—âˆ§(xáµ—,xá¶œ)âˆ¨(xá¶œ,[])))
    root = (repâ‰”ó°²¡ğ(x)Â¿xá¹á”Â¡ğ(xâ‚€,â ¤xâ‚á´rep))âˆ˜root
    â†ªroot
root = do_thing(dat)

Â¿file_fail:
    rootá´¾î®¦â˜¾

âŠ¢tree_manip(ó±•, max_stage=999999):
    #â˜¾â†ó±•áµ—
    âŠ¢ Æ’(ó±•, rule):
        cpy_code = (ó±•á¶œá´ó°²¡xáµ—)â¨á¦â†’â‚ï¹•â‚‹â‚
        ctex_code = moo(cpy_code,m=ó±•á¶œâ‚€áµ—)
        #â€¹âŸ¦ctex_codeâŸ§ â†’ âŸ¦ruleâŸ§â€ºâ˜¾
        Â¿Â¬ctex_code:
            â†ªğ("john smith")
        new_root = do_thing(ctex_code,rule)
        #new_rootá´¾î®¦â˜¾
        new_ó±• = tree_manip(new_root)
        â†ª new_ó±•
    moons=["moon","texmoon","fmoon"]
    map=â„µ(
        simple="simple",
        component="component",
        com_math_seq="com_math_seq",
        block_math_seq="block_math_seq",
        line_math_seq="com_math_seq",
        det_math_seq="com_math_seq",
        word_seq="com_sequence"
    )
    â†ªó±•.frp(ó°²¡xá¶œ,
           ó°²¡x.copy(c=[ğ‘™(Æ’(y,mapâ‚“ôŠ«¼)á¶œ)Â¿yá¶œâˆ§yáµ—âˆˆmoonsÂ¡[tree_manip(y)]âˆ€yâˆˆxá¶œ]â¨[]))
    #â†ªó±•
âŠ¢ swauce(n,â ¶ğ“š):
    Â¿náµ—â‰¡"en_word":
        ğ“š=ğ“š|{"seen_en_sec":â´³}
    Â¡:
        Â¿náµ—â‰¡"sub"âˆ§"seen_en_sec"âˆ‰ğ“š:
            â†ªğ("SUB", swauce(do_thing(SCRIPT.nrm(ná¶œá´ó°²¡xáµ—ó°…‚â¨á¦), "com_math_seq")))
        Â¿náµ—â‰¡"sup"âˆ§"seen_en_sec"âˆ‰ğ“š:
            â†ªğ("SUP", swauce(do_thing(SCRIPT.nrm(ná¶œá´ó°²¡xáµ—ó°…‚â¨á¦), "com_math_seq")))
    ná¶œ = ná¶œ á´ ó°²¡swauce(x,â ¶ğ“š)
    â†ª n
âŠ¢ do_is(n,i=á¦,p=âœ“):
    nc=[]
    âˆ€jâˆˆâ­¥ğŸƒŒná¶œ:
        nj,i,p=do_is(ná¶œâ±¼,i,p)
        nc.append(nj)
    ná¶œ=nc
    Â¿náµ—â‚€âˆˆâ€¹ó°˜¨ó±•ó°¡·ó±˜ï´ó°¬€ó±‡™ó°‘‡ó°«°ó±¨¹ïƒï„¶â–¢ïˆ±ó°•ï”ó°Šó°¬ó°·”ó±î™³ó°¡±á¾‡ï‰½ó°«ºó°—´ó°¨¥ó°«´ó°«¿î˜¨ó°«³ó°¬ƒó±—¿ó°«±âŒó±§¡ó°«¶ó°¬‚ó°«½ó°«²î™‘ó°Š•â°ó°«®ó°Š°ó°’ó°š¥ó°‘ó°‰·ó° ©ó°‘­ó°‰½âœ“ó°Š„ï‰«ó°¿¨âš™ó°‰î‰¿ó°’ó°£°â‹â«¢â‰–âˆ€âˆƒâˆ§âˆ¨ğ…Ÿğ…¢âœ£â‰âŠá”²ğŸ¤â†˜Â¿Â¡âˆµâˆ´â†£âŸâš‡Ã†ó°˜¡ó°¡ó°˜£â‡â˜’ó°‡šó±‚°ó°®§ó±—ó±…™ó±–ó°¶€ó°¶ó°¶‚ó°¶ƒó°¶„â”âœ“âŠ¯â®â®ŒâªŸâª ó°¨ˆâ˜‘â˜’â€º âˆ§ p:
        náµ—=â›ôŠ·¯+náµ—
        p = âœ—
    Â¿náµ—â‰¡"heading":
        p=âœ“
    Â¿náµ—âˆ‰" \n\t" âˆ§ náµ—ğŸƒŒâ‰¡1:
        p=(náµ—âˆˆâ€¹â˜ .!?âŠ¢â€º)
    Â¿â›â‰âˆˆnáµ—:
        â†ªn,"á´®",p
    Â¿â›âŠâˆˆnáµ—:
        â†ªn,"á´¬",p
    Â¿â›â«¢âˆˆnáµ—:
        náµ—+=i
        â†ªn,á¦,p
    Â¿â›á”²âˆˆnáµ—âˆ¨náµ—âˆˆ"component"â‹„"simple":
        â†ªn,á¦,p
    â†ªn,i,p
âŠ¢ swooce(n):
    ná¶œ = ná¶œ á´ swooce
    Â¿náµ—â‰¡"com_word" âˆ¨ náµ—â‰¡"block_word":
        â†ªâ€¹{\text{âŸ¦ná¶œâ‚âŸ§}}â€º
    Â¿náµ—â‰¡"com_frac" âˆ¨ náµ—â‰¡"block_frac":
        â†ªâ€¹{\frac{âŸ¦ná¶œâ‚âŸ§}{âŸ¦ná¶œâ‚ƒâŸ§}}â€º
    Â¿náµ—â‰¡"com_legendre" âˆ¨ náµ—â‰¡"block_legendre":
        â†ªâ€¹{\left(\frac{âŸ¦ná¶œâ‚âŸ§}{âŸ¦ná¶œâ‚ƒâŸ§}\right)}â€º
    Â¿náµ—â‰¡"com_nCr" âˆ¨ náµ—â‰¡"block_nCr":
        â†ªâ€¹{\binom{âŸ¦ná¶œâ‚âŸ§}{âŸ¦ná¶œâ‚ƒâŸ§}}â€º
    Â¿náµ—â‰¡"com_rad" âˆ¨ náµ—â‰¡"block_rad":
        Â¿ná¶œâ‚€â‰¡â€¹ã€”â€º:
            â†ªâ€¹{\sqrt[âŸ¦ná¶œâ‚âŸ§]{âŸ¦ná¶œâ‚„âŸ§}}â€º
        â¸˜ná¶œâ‚€â‰¡â€¹âˆ›â€º:
            â†ªâ€¹{\sqrt[3]{âŸ¦ná¶œâ‚âŸ§}}â€º
        â¸˜ná¶œâ‚€â‰¡â€¹âˆœâ€º:
            â†ªâ€¹{\sqrt[4]{âŸ¦ná¶œâ‚âŸ§}}â€º
        Â¡:
            â†ªâ€¹{\sqrt{âŸ¦ná¶œâ‚âŸ§}}â€º
    Â¿náµ—â‰¡"SUB":
        â†ªâ€¹_{âŸ¦ná¶œâ¨âŸ§}â€º
    Â¿náµ—â‰¡"SUP":
        â†ªâ€¹^{âŸ¦ná¶œâ¨âŸ§}â€º
    Â¿náµ—â‰¡"det_math_seq":
        â†ªâ€¹$âŸ¦repl(ná¶œâ¨)âŸ§$â€º
    Â¿náµ—â‰¡"dollar_math"âˆ§ná¶œâ‚€â‰¡"ó·¹¹":
        â†ªâ€¹$âŸ¦repl(ná¶œâ‚ï¹•â¨)âŸ§$â€º
    Â¿náµ—â‰¡"c_math":
        â†ªâ€¹$âŸ¦repl((ná¶œâ¨á¦)â‚ï¹•)âŸ§$â€º
    Â¿náµ—â‰¡"env_math":
        â†ªâ€¹\begin{âŸ¦eâ‰”env(ná¶œâ‚€)âŸ§}âŸ¦repl(ná¶œâ‚)âŸ§\end{âŸ¦eâŸ§}â€º
    Â¿náµ—â‰¡"block_math_seq":
        â†ª(ná¶œâ¨).replace(â€¹â ¤ğ—»â€º,â€¹ â€º).replace(â€¹ğ—»â€º,â€¹\\ğ—»â€º)
    Â¿náµ—â‰¡"item":
        â†ªâ€¹\itemâŸ¦â€¹[âŸ¦ná¶œâ‚‚âŸ§]â€ºÂ¿ná¶œğŸƒŒ>1Â¡á¦âŸ§ â€º
    Â¿náµ—â‰¡"list":
        â†ªâ€¹\begin{âŸ¦eâ‰”env(ná¶œâ‚€)âŸ§}âŸ¦ná¶œâ‚ï¹•â‚‹â‚â¨âŸ§\end{âŸ¦eâŸ§}â€º
    Â¿náµ—â‰¡"other_env":
        â†ªâ€¹\begin{âŸ¦eâ‰”env(ná¶œâ‚€)âŸ§}âŸ¦ná¶œâ‚âŸ§\end{âŸ¦eâŸ§}â€º
    Â¿náµ—â‰¡"preset":
        â†ªpre(ná¶œâ¨)
    Â¿náµ—â‰¡"comment":
        â†ªâ›%+(ná¶œâ¨)
    Â¿náµ—â‰¡"en_word":
        â†ªâ€¹ $ âŸ¦enify(ná¶œâ¨)âŸ§ $ â€º
    Â¿náµ—â‰¡"open":
        â†ªpar(nâ‚€)
    Â¿náµ—â‰¡"close":
        â†ªpar(nâ‚€)
    Â¿náµ—â‰¡"word_seq":
        Â¿ná¶œ:
            â†ªná¶œâ¨
        â†ªá¦
    â†ª ná¶œâ¨ Â¿ná¶œÂ¡ náµ—
troot=tree_manipâˆ˜root
Â¿file_fail:
    trootá´¾î®¦â˜¾
swauroot=swauceâˆ˜troot
iswauroot,_,_=do_is(swauroot)
swooroot=swooceâˆ˜iswauroot
swooroot = swooroot.replace(â€¹$ $ â€º,á¦)
swooroot = swooroot.replace(â€¹ $  $ â€º,â› )
swooroot = swooroot.replace(â€¹ .â€º,â›.)
swooroot = swooroot.replace(â€¹\lim \sup â€º,â€¹\limsupâ€º)
swooroot = swooroot.replace(â€¹\lim \inf â€º,â€¹\liminfâ€º)
swooroot+=â€¹ğ—»\end{document}â€º
swoorootâ†’â˜¾

try:
    f.close()
except:
    pass